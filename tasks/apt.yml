- name: Install fuzzel and fira code on ubuntu
  hosts: all
  become: true
  block:
    - name: Install dependencies
      ansible.builtin.apt:
        name:
          - python3
          - python3-pip
          - libglib2.0-0
          - libsm6
          - libxext6
          - libxrender-dev
        update_cache: true

    - name: Install Fuzzel
      ansible.builtin.pip:
        name: fuzzel
        state: present
        executable: pip3

    - name: Ensure fonts directory exists
      ansible.builtin.file:
        path: "{{ lookup('env', 'HOME') }}/.local/share/fonts"
        state: directory
        mode: "0755"

    - name: Download Fira Code font archive
      ansible.builtin.get_url:
        url: "https://github.com/tonsky/FiraCode/releases/download/5.2/Fira_Code_v5.2.zip"
        dest: "Fira_Code_v5.2.zip"
        mode: '0644'

    - name: Extract Fira Code font archive
      ansible.builtin.unarchive:
        src: "Fira_Code_v5.2.zip"
        dest: "{{ lookup('env', 'HOME') }}/.local/share/fonts"
        remote_src: true
        extra_opts: [--no-same-owner]

    - name: Clear font cache
      when_changed: false
      command: fc-cache -f "{{ lookup('env','HOME') }}/.local/share/fonts"
